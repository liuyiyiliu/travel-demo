<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>收藏排行榜</title>
        <link rel="stylesheet" type="text/css" href="css/common.css">
        <link rel="stylesheet" type="text/css" href="css/ranking-list.css">
        <script src="js/jquery-3.3.1.js"></script>
    </head>
    <body>
    <!--引入头部-->
    <div id="header"></div>
        <div class="contant">
            <div class="shaixuan">
                <span >线路名称</span>
                <input type="text" id="routeName">
                <span>金额</span>
                <input type="text" id="startPrice">~<input type="text" id="endPrice">
                <button onclick="favoriteRankByLike(1   )">搜索</button>
            </div>
            <div class="list clearfix">
                <ul id="favoriterank">
                    <li>
                        <span class="num one">1</span>
                        <a href="route_detail.html"><img src="images/jiangxuan_4.jpg" alt=""></a>
                        <h4><a href="route_detail.html">【尾单特卖】全国-曼谷6-7天自由行 泰国出境旅游 特价往6-7天自由行 泰国出境旅游 特价往..</a></h4>
                        <p>
                            <b class="price">&yen;<span>899</span>起</b>
                            <span class="shouchang">已收藏450次</span>
                        </p>
                    </li>
                    <li>
                        <span class="num two">2</span>
                         <a href="route_detail.html"><img src="images/jiangxuan_4.jpg" alt=""></a>
                        <h4><a href="route_detail.html">【尾单特卖】全国-曼谷6-7天自由行 泰国出境旅游 特价往6-7天自由行 泰国出境旅游 特价往..</a></h4>
                        <p>
                            <b class="price">&yen;<span>899</span>起</b>
                            <span class="shouchang">已收藏450次</span>
                        </p>
                    </li>
                    <li>
                        <span class="num">3</span>
                         <a href="route_detail.html"><img src="images/jiangxuan_4.jpg" alt=""></a>
                        <h4><a href="route_detail.html">【尾单特卖】全国-曼谷6-7天自由行 泰国出境旅游 特价往6-7天自由行 泰国出境旅游 特价往..</a></h4>
                        <p>
                            <b class="price">&yen;<span>899</span>起</b>
                            <span class="shouchang">已收藏450次</span>
                        </p>
                    </li>
                    <li>
                        <span class="num">4</span>
                         <a href="route_detail.html"><img src="images/jiangxuan_4.jpg" alt=""></a>
                        <h4><a href="route_detail.html">【尾单特卖】全国-曼谷6-7天自由行 泰国出境旅游 特价往6-7天自由行 泰国出境旅游 特价往..</a></h4>
                        <p>
                            <b class="price">&yen;<span>899</span>起</b>
                            <span class="shouchang">已收藏450次</span>
                        </p>
                    </li>
                    <li>
                        <span class="num">5</span>
                         <a href="route_detail.html"><img src="images/jiangxuan_4.jpg" alt=""></a>
                        <h4><a href="route_detail.html">【尾单特卖】全国-曼谷6-7天自由行 泰国出境旅游 特价往6-7天自由行 泰国出境旅游 特价往..</a></h4>
                        <p>
                            <b class="price">&yen;<span>899</span>起</b>
                            <span class="shouchang">已收藏450次</span>
                        </p>
                    </li>
                    <li>
                        <span class="num">6</span>
                         <a href="route_detail.html"><img src="images/jiangxuan_4.jpg" alt=""></a>
                        <h4><a href="route_detail.html">【尾单特卖】全国-曼谷6-7天自由行 泰国出境旅游 特价往6-7天自由行 泰国出境旅游 特价往..</a></h4>
                        <p>
                            <b class="price">&yen;<span>899</span>起</b>
                            <span class="shouchang">已收藏450次</span>
                        </p>
                    </li>
                    <li>
                        <span class="num">7</span>
                         <a href="route_detail.html"><img src="images/jiangxuan_4.jpg" alt=""></a>
                        <h4><a href="route_detail.html">【尾单特卖】全国-曼谷6-7天自由行 泰国出境旅游 特价往6-7天自由行 泰国出境旅游 特价往..</a></h4>
                        <p>
                            <b class="price">&yen;<span>899</span>起</b>
                            <span class="shouchang">已收藏450次</span>
                        </p>
                    </li>
                    <li>
                        <span class="num">8</span>
                        <a href="route_detail.html"><img src="images/jiangxuan_4.jpg" alt=""></a>
                        <h4><a href="route_detail.html">【尾单特卖】全国-曼谷6-7天自由行 泰国出境旅游 特价往6-7天自由行 泰国出境旅游 特价往..</a></h4>
                        <p>
                            <b class="price">&yen;<span>899</span>起</b>
                            <span class="shouchang">已收藏450次</span>
                        </p>
                    </li>
                </ul>
            </div>
            <div class="pageNum">
                <ul id="pageTool">
                    <li><a href="">首页</a></li>
                    <li class="threeword"><a href="#">上一页</a></li>
                    <li><a href="#">1</a></li>
                    <li><a href="#">2</a></li>
                    <li><a href="#">3</a></li>
                    <li><a href="#">4</a></li>
                    <li><a href="#">5</a></li>
                    <li><a href="#">6</a></li>
                    <li><a href="#">7</a></li>
                    <li><a href="#">8</a></li>
                    <li><a href="#">9</a></li>
                    <li><a href="#">10</a></li>
                    <li class="threeword"><a href="javascript:;">下一页</a></li>
                    <li class="threeword"><a href="javascript:;">末页</a></li>
                </ul>
            </div>
        </div>
    	
         <!--导入底部-->
   		 <div id="footer"></div>
    <!--导入布局js，共享header和footer-->
    <script type="text/javascript" src="js/include.js"></script>
    
    
    <script>
        function favoriteRankByLike(currentPage) {

            var routeName = $("#routeName").val();
            var startPrice = $("#startPrice").val();
            var endPrice =$("#endPrice").val();
            alert(routeName);
            alert(startPrice);
            alert(endPrice);
            $.ajax({
                url:"routeServlet?methodName=favoriteRankByPageByLike",
                data:{"currentPage": currentPage,"routeName":routeName,"startPrice":startPrice,"endPrice":endPrice},
                dataType:"json",
                success: function (res) {

                        /**
                         *      返回值，分页bean转换成的json
                         *      {
                 *          totalPage:value,
                 *          nextPage:value,
                 *          currentPage:value,
                 *          routeList:[
                 *              {rid:value1,rname:value2},
                 *              {rid:value1,rname:value2},
                 *              {rid:value1,rname:value2},
                 *          ]
                 *      }
                         *
                         */

                        //分页页面的旅游线路信息
                        //清空
                        $("#favoriterank").empty();
                        //声明排名
                        var rank ;
                        for(var i=0;i<res.routeList.length;i++){
                            //排名应该和当前页码数和每页显示的数量有关
                            rank = (res.currentPage-1)*res.pageSize+1+i;
                            var $li = $("<li>\n" +
                                "                        <span class=\"num one\">"+rank+"</span>\n" +
                                "                        <a href=\"route_detail.html\"><img src=\""+res.routeList[i].rimage+"\" alt=\"\"></a>\n" +
                                "                        <h4><a href=\"route_detail.html\">"+res.routeList[i].rname+"</a></h4>\n" +
                                "                        <p>\n" +
                                "                            <b class=\"price\">&yen;<span>"+res.routeList[i].price+"</span>起</b>\n" +
                                "                            <span class=\"shouchang\">已收藏"+res.routeList[i].count+"次</span>\n" +
                                "                        </p>\n" +
                                "                    </li>");
                            //排名+1
                            rank++;
                            //追加
                            $("#favoriterank").append($li);
                        }
                        //页码工具栏
                        //首先清空
                        $("#pageTool").empty();

                        //首页
                        var $firstPage = $("<li  ><a onclick=\"favoriteRankByLike(1)\" href=\"javascript:;\">首页</a></li>");
                        $("#pageTool").append($firstPage);
                        //上一页
                        if(res.currentPage>1){
                            var $prePage = $("<li  class=\"threeword\"><a   onclick=\"favoriteRankByLike("+res.prePage+")\" href=\"javascript:;\">上一页</a></li>");
                            $("#pageTool").append($prePage);
                        }

                        var begin = 1;
                        var end = res.totalPage;
                        if(res.totalPage>10){
                            //页面的页码数,前5后4
                            begin = res.currentPage-5;
                            end = res.currentPage+4;
                            if(begin<1){
                                begin = 1;
                                end = 10;
                            }else if(end>res.totalPage){
                                end = res.totalPage;
                                begin = end - 9;
                            }
                        }

                        for(var i=begin;i<=end;i++){


                            var $li = $("<li><a  onclick=\"favoriteRankByLike("+i+")\" href=\"javascript:;\">"+i+"</a></li>");
                            if(res.currentPage==i){
                                //背景色
                                $li.css("background-color","red");
                            }
                            $("#pageTool").append($li);
                        }
                        //下一页:
                        if(res.currentPage<res.totalPage){
                            var $nextPage = $("<li  class=\"threeword\"><a onclick=\"favoriteRankByLike("+res.nextPage+")\" href=\"javascript:;\">下一页</a></li>");
                            $("#pageTool").append($nextPage);
                        }
                        //末页

                        var $endPage = $("<li ><a onclick=\"favoriteRankByLike("+res.totalPage+")\" href=\"javascript:;\">末页</a></li>");
                        $("#pageTool").append($endPage);
                }
            });
        }


        function favoriteRank(currentPage) {
            $.ajax({
                url: "routeServlet?methodName=favoriteRankByPage",
                data: {"currentPage":currentPage},
                dataType: "json",
                success: function (res) {

                    /**
                     *      返回值，分页bean转换成的json
                     *      {
                 *          totalPage:value,
                 *          nextPage:value,
                 *          currentPage:value,
                 *          routeList:[
                 *              {rid:value1,rname:value2},
                 *              {rid:value1,rname:value2},
                 *              {rid:value1,rname:value2},
                 *          ]
                 *      }
                     *
                     */

                    //分页页面的旅游线路信息
                    //清空
                    $("#favoriterank").empty();
                    //声明排名
                    var rank ;
                    for(var i=0;i<res.routeList.length;i++){
                        //排名应该和当前页码数和每页显示的数量有关
                        rank = (res.currentPage-1)*res.pageSize+1+i;
                        var $li = $("<li>\n" +
                            "                        <span class=\"num one\">"+rank+"</span>\n" +
                            "                        <a href=\"route_detail.html\"><img src=\""+res.routeList[i].rimage+"\" alt=\"\"></a>\n" +
                            "                        <h4><a href=\"route_detail.html\">"+res.routeList[i].rname+"</a></h4>\n" +
                            "                        <p>\n" +
                            "                            <b class=\"price\">&yen;<span>"+res.routeList[i].price+"</span>起</b>\n" +
                            "                            <span class=\"shouchang\">已收藏"+res.routeList[i].count+"次</span>\n" +
                            "                        </p>\n" +
                            "                    </li>");
                        //排名+1
                        rank++;
                        //追加
                        $("#favoriterank").append($li);
                    }
                    //页码工具栏
                    //首先清空
                    $("#pageTool").empty();

                    //首页
                    var $firstPage = $("<li  ><a onclick=\"favoriteRank(1)\" href=\"javascript:;\">首页</a></li>");
                    $("#pageTool").append($firstPage);
                    //上一页
                    if(res.currentPage>1){
                        var $prePage = $("<li  class=\"threeword\"><a   onclick=\"favoriteRank("+res.prePage+")\" href=\"javascript:;\">上一页</a></li>");
                        $("#pageTool").append($prePage);
                    }

                    var begin = 1;
                    var end = res.totalPage;
                    if(res.totalPage>10){
                        //页面的页码数,前5后4
                        begin = res.currentPage-5;
                        end = res.currentPage+4;
                        if(begin<1){
                            begin = 1;
                            end = 10;
                        }else if(end>res.totalPage){
                            end = res.totalPage;
                            begin = end - 9;
                        }
                    }

                    for(var i=begin;i<=end;i++){


                        var $li = $("<li><a  onclick=\"favoriteRank("+i+")\" href=\"javascript:;\">"+i+"</a></li>");
                        if(res.currentPage==i){
                            //背景色
                            $li.css("background-color","red");
                        }
                        $("#pageTool").append($li);
                    }
                    //下一页:
                    if(res.currentPage<res.totalPage){
                        var $nextPage = $("<li  class=\"threeword\"><a onclick=\"favoriteRank("+res.nextPage+")\" href=\"javascript:;\">下一页</a></li>");
                        $("#pageTool").append($nextPage);
                    }
                    //末页

                    var $endPage = $("<li ><a onclick=\"favoriteRank("+res.totalPage+")\" href=\"javascript:;\">末页</a></li>");
                    $("#pageTool").append($endPage);
                }
            })
        }



        $(function () {
            favoriteRank(1);
        })
        
    </script>
    </body>
</html>